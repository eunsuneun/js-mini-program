<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ë°˜ì‘ì†ë„ êµ¬í•˜ê¸°</title>
    <style>
      * {
        padding: 0;
        margin: 0;
        box-sizing: border-box;
      }
      #screen {
        width: 100%;
        height: 50vh;
        font-size: 20px;
        text-align: center;
        line-height: 50vh;
        color: #fff;
      }
      #screen.ready {
        background: darkblue;
      }
      #screen.set {
        background: orangered;
      }
      #screen.go {
        background: greenyellow;
        color: #333;
      }
      .row {
        background: #f4f5f6;
        display: flex;
      }
      .column {
        width: 33.3333%;
        padding: 20px;
        text-align: center;
        line-height: 2;
      }
      .column + .column {
        border-left: 1px solid #ddd;
      }
      .tit {
        display: inline-block;
        width: 100%;
        font-weight: 700;
      }
      .cont {
        /* ê¸°ë¡ë˜ì–´ì§ˆ ë•Œ display: block ë˜ë„ë¡ jsì—ì„œ ì œì–´ */
        display: none;
        margin: 10px 0 0 0;
      }
    </style>
  </head>
  <body>
    <div id="screen" class="ready">í´ë¦­í•˜ë©´ ì‹œì‘ë©ë‹ˆë‹¤ ğŸ¤ŸğŸ»</div>
    <div class="row">
      <div id="result" class="column">
        <span class="tit">ë°˜ì‘ì†ë„ ê¸°ë¡</span>
        <div class="cont"></div>
      </div>
      <div id="average" class="column">
        <span class="tit">í‰ê· ì†ë„ ê¸°ë¡</span>
        <div class="cont"></div>
      </div>
      <div id="top" class="column">
        <span class="tit">TOP5 ê¸°ë¡</span>
        <div class="cont"></div>
      </div>
    </div>
    <script>
      // ì´ˆê¸° ë³€ìˆ˜
      const $screen = document.querySelector("#screen");
      const $result = document.querySelector("#result .cont");
      const $average = document.querySelector("#average .cont");
      const $top = document.querySelector("#top .cont");
      window.document.oncontextmenu = new Function("return false");
      window.document.onselectstart = new Function("return false");
      window.document.ondragstart = new Function("return false");

      // ë°ì´í„° ì €ì¥ ë³€ìˆ˜
      let startTime;
      let endTime;
      const records = [];
      let timeoutId;
      $screen.addEventListener("click", event => {
        if (event.target.classList.contains("ready")) {
          // íŒŒë‘ í™”ë©´ì¼ ë•Œ í´ë¦­í•˜ë©´
          // ë¹¨ê°• í™”ë©´ìœ¼ë¡œ ë°”ë€ŒëŠ” ì½”ë“œ
          $screen.classList.replace("ready", "set");
          $screen.textContent = "ì´ˆë¡ìƒ‰ í™”ë©´ì´ ë‚˜ì˜¤ë©´ í´ë¦­í•˜ì„¸ìš” ! âœŒğŸ»";
          // ë¹¨ê°•í™”ë©´ìœ¼ë¡œ ë°”ë€ í›„ì— ëœë¤ ì´ˆë¡œ ì´ˆë¡í™”ë©´,íƒ€ì´ë¨¸ ì‹¤í–‰í•˜ëŠ” ì½”ë“œ
          timeoutId = setTimeout(() => {
            startTime = new Date();
            $screen.classList.replace("set", "go");
            $screen.textContent = "ì§€ê¸ˆì´ì—ìš” ! ğŸ‘‰ğŸ»";
          }, Math.floor(Math.random() * 1000) + 2000); // 2000~3000 ì‚¬ì´
        } else if ($screen.classList.contains("set")) {
          // ë¹¨ê°• í™”ë©´ì¼ ë•Œ í´ë¦­í•˜ë©´
          // íŒŒë‘ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°
          clearTimeout(timeoutId);
          $screen.classList.replace("set", "ready");
          $screen.textContent = "ì„±ê¸‰í•˜ì‹œë„¤ìš” ğŸ¤­ í´ë¦­í•˜ë©´ ì‹œì‘ë©ë‹ˆë‹¤ ğŸ¤ŸğŸ»";
        } else if ($screen.classList.contains("go")) {
          // .contë¥¼ display:noneì—ì„œ block ìœ¼ë¡œ ë°”ê¿”ì£¼ê³  ì‹œì‘ (ì—¬ë°±ë•Œë¬¸ã…)
          document.querySelectorAll(".cont")[0].style.display = "block";
          document.querySelectorAll(".cont")[1].style.display = "block";
          document.querySelectorAll(".cont")[2].style.display = "block";
          // ì´ˆë¡ í™”ë©´ì¼ ë•Œ í´ë¦­í•˜ë©´
          endTime = new Date();
          const current = endTime - startTime;
          $result.append(`${current}ms`, document.createElement("br"));
          // í‰ê·  êµ¬í•˜ê¸°
          records.push(current);
          const average = Math.floor(records.reduce((a, c) => a + c) / records.length);
          $average.append(`${average}ms`, document.createElement("br"));
          // top5 ë³´ì—¬ì£¼ê¸°
          $top.innerHTML = ""; // ìˆœìœ„ ì´ˆê¸°í™” ì‹œì¼œì£¼ë©´ì„œ ë‹¤ì‹œ ë³´ì—¬ì£¼ê¸° ìœ„í•´ì„œ
          const topFive = records.sort((a, b) => a - b).slice(0, 5);
          topFive.forEach((top, index) => {
            $top.append(`${index + 1}ìœ„ : ${top}ms`, document.createElement("br"));
          });
          // startTime, endTime ì´ˆê¸°í™” (ì•ˆí•´ë„ ë˜ì§€ë§Œ í˜¹ì‹œë‚˜)
          startTime = null;
          endTime = null;
          // ë‹¤ì‹œ íŒŒë‘í™”ë©´ìœ¼ë¡œ ë°”ë€ŒëŠ” ì½”ë“œ
          $screen.classList.replace("go", "ready");
          $screen.textContent = "í´ë¦­í•˜ë©´ ì‹œì‘ë©ë‹ˆë‹¤ ğŸ¤ŸğŸ»";
        }
      });
    </script>
  </body>
</html>
